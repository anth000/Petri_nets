<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Visualiseur de Réseau de Petri</title>
    <!--
      Cette version modifiée du fichier pnet.html applique un thème sombre et
      francise l'interface utilisateur. Le logo ne renvoie plus vers la page
      d'accueil supprimée et les libellés des boutons sont traduits en
      français. Les couleurs ont été adaptées pour se rapprocher de la
      maquette fournie par l'utilisateur.
    -->
    <script src="scripts/jquery-1.9.1.min.js"></script>
    <!-- Bootstrap 3 depuis CDN pour conserver la compatibilité -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
      integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
      crossorigin="anonymous"
    />
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="css/bootstrap_override.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="scripts/raphael-min.js"></script>
    <script src="js/arrows.js"></script>
    <script src="js/pnet.js"></script>
    <script src="js/pnet_run.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <style>
      /* Styles originaux conservés pour l'icône de chargement */
      .fa-cog {
        font-size: 36px;
        color: red;
      }
      .cursor-hand {
        cursor: pointer;
      }
      /* Thème sombre inspiré de la maquette */
      body {
        background-color: #0A173A;
        color: #e1e5ee;
      }
      .navbar.navbar-default {
        background-color: #14213D;
        border: none;
      }
      .navbar-brand img {
        height: 25px;
      }
      /* Zone centrale */
      .center-container,
      .center-row {
        background-color: #0A173A;
      }
      /* Pied de page */
      #footer {
        background-color: #14213D;
      }
      #footer span {
        color: #b0b8d6;
      }
      /* Boutons personnalisés */
      .btn-primary {
        background-color: #3A5BAA;
        border-color: #3A5BAA;
      }
      .btn-danger {
        background-color: #C84C5D;
        border-color: #B03E4F;
      }
      .btn-info {
        background-color: #2986CC;
        border-color: #2373A8;
      }
      .btn-success {
        background-color: #3FA94C;
        border-color: #348C3F;
      }
      .dropdown-menu {
        background-color: #1e2a47;
      }
      .dropdown-menu > li > a {
        color: #ffffff;
      }
      .dropdown-menu > li > a:hover {
        background-color: #2c3e68;
      }
      /* Onglets de navigation pour visualisation/édition */
      .nav-tabs {
        border-bottom: 1px solid #2c3e68;
        margin-top: 55px;
      }
      .nav-tabs > li > a {
        color: #b0b8d6;
      }
      .nav-tabs > li.active > a {
        background-color: #14213D;
        color: #ffffff;
        border: 1px solid #2c3e68;
        border-bottom-color: transparent;
      }
    </style>
  </head>
  <body onload="onload()" onresize="body_onresize()">
    <div id="wrap">
      <!-- Barre de navigation et barre d'outils -->
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
          <div class="nav navbar-header">
            <!-- Logo sans lien vers la page d'accueil -->
            <span class="navbar-brand"><img src="images/logo.png" alt="Logo" /></span>
            <!-- Affichage de l'objet sélectionné -->
            <div class="btn-group navbar-btn">
              <code
                id="selected_label"
                onclick="toolbar_clicked()"
                style="cursor:pointer; float:left;font-family:'Courier New';width: 60px;text-align:center;font-weight:bolder; font-size:12pt; border:solid gray 1px;"
                >&nbsp;</code
              >
            </div>
            &nbsp;
            <!-- Ajout / suppression de jetons -->
            <div class="btn-group navbar-btn">
              <button class="btn btn-success btn-sm" id="btnTokenAdd" title="Ajouter un jeton">
                <span class="glyphicon glyphicon-plus"></span>
              </button>
              <button class="btn btn-success btn-sm" id="btnTokenRemove" title="Retirer un jeton">
                <span class="glyphicon glyphicon-minus"></span>
              </button>
            </div>
          </div>
          &nbsp;
          <!-- Outils de création et de gestion du réseau -->
          <div class="btn-group navbar-btn">
            <button class="btn btn-primary btn-sm" id="btnAddPlace">
              <span class="glyphicon glyphicon-plus"></span> Place
            </button>
            <button class="btn btn-primary btn-sm" id="btnAddTrans">
              <span class="glyphicon glyphicon-plus"></span> Transition
            </button>
            <button class="btn btn-primary btn-sm" id="btnRemoveObj">
              <span class="glyphicon glyphicon-remove"></span> Supprimer
            </button>
            <button class="btn btn-primary btn-sm" id="btnClearPaper">
              <span class="glyphicon glyphicon-remove-circle"></span> Effacer
            </button>
          </div>
          &nbsp;
          <!-- Commandes d'exécution -->
          <div class="btn-group navbar-btn">
            <button class="btn btn-danger btn-sm" id="btnRun">
              <span class="glyphicon glyphicon-play"></span> Démarrer
            </button>
            <button class="btn btn-danger btn-sm" id="btnStop">
              <span class="glyphicon glyphicon-stop"></span> Arrêter
            </button>
          </div>
          &nbsp;
          <!-- Commandes d'enregistrement et de restauration -->
          <div class="btn-group navbar-btn">
            <button class="btn btn-info btn-sm" id="btnSaveLocal">
              <span class="glyphicon glyphicon-import"></span> Sauvegarder
            </button>
            <button class="btn btn-info btn-sm" id="btnRestoreLocal">
              <span class="glyphicon glyphicon-export"></span> Restaurer
            </button>
            <input id="fileinput" type="file" style="display:none;" onchange="restore_fromFile()" />
            <button class="btn btn-info btn-sm" id="btnFalseInput">
              <span class="glyphicon glyphicon-open"></span> Ouvrir
            </button>
            <button class="btn btn-info btn-sm" id="btnDownload">
              <span class="glyphicon glyphicon-download"></span> Télécharger
            </button>
          </div>
          &nbsp;
          <!-- Liste des exemples -->
          <div class="btn-group navbar-btn">
            <a
              class="dropdown-toggle btn btn-success btn-sm"
              data-toggle="dropdown"
              role="button"
              aria-haspopup="true"
              aria-expanded="false"
              id="btnExamples"
            >
              <span class="glyphicon glyphicon-menu-hamburger"></span> Exemples
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li><a id="Example1" class="cursor-hand">Exemple 1</a></li>
              <li><a id="Example2" class="cursor-hand">Exemple 2</a></li>
              <li><a id="Example3" class="cursor-hand">Exemple 3</a></li>
              <li><a id="Example4" class="cursor-hand">Exemple 4</a></li>
              <li><a id="Example5" class="cursor-hand">Exemple 5</a></li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Onglets Visualisation / Éditeur -->
      <ul class="nav nav-tabs">
        <li>
          <a href="#" onclick="alert('La fonctionnalité de visualisation n\'est pas encore implémentée.'); return false;">Visualisation</a>
        </li>
        <li class="active"><a href="#">Éditeur</a></li>
      </ul>
      <!-- Zone principale de travail -->
      <div class="center-container">
        <div class="center-row" id="center_row" style=""></div>
      </div>
      <!-- Pied de page -->
      <div id="footer">
        <div>
          &nbsp;
          <span style="float:left;font-family:'Courier New';width: 60px;text-align:right;padding-right:10px;">
            <i class="fa fa-caret-right" style="font-size:20px;" id="status_icon"></i>
          </span>
          <span id="status_bar" style="float:left;font-size:10pt;"></span>
          <span style="float: right; font-size:9pt;">&copy; <i>2017 - hp102 production&nbsp;</i>&nbsp;</span>
        </div>
        <div class="container"></div>
      </div>
    </div>
    <!-- Script original conservé pour le fonctionnement interne -->
    <script>
      function toolbar_clicked() {
        unselect();
      }
      var paper = null;
      function onload() {
        set_paper();
        ini_button("btnAddTrans", function () {
          NewTransition(35, 45);
        }, "Ajouter une transition");
        ini_button("btnAddPlace", function () {
          NewPlace(35, 45);
        }, "Ajouter une place");
        ini_button("btnRemoveObj", function () {
          RemoveObject();
        }, "Supprimer l'objet sélectionné");
        ini_button("btnClearPaper", function () {
          clear_paper();
        }, "Effacer le canevas");
        ini_button("btnRun", function () {
          run_clicked();
        }, "Exécuter le réseau de Petri");
        ini_button("btnStop", function () {
          stop_clicked();
        }, "Arrêter l'exécution");
        ini_button("btnSaveLocal", function () {
          save_local();
        }, "Sauvegarder en mémoire locale");
        ini_button("btnRestoreLocal", function () {
          restore_local();
        }, "Restaurer depuis la mémoire locale");
        ini_button("btnFalseInput", function () {
          open_clicked();
        }, "Ouvrir depuis un fichier");
        ini_button("btnDownload", function () {
          save_toFile();
        }, "Télécharger sous forme de fichier");
        ini_button("btnTokenAdd", function () {
          token_add();
        }, "Ajouter un jeton à la place sélectionnée");
        ini_button("btnTokenRemove", function () {
          token_remove();
        }, "Retirer un jeton de la place sélectionnée");
        ini_button("Example1", function () {
          load_example(1);
        }, "Exemple 1");
        ini_button("Example2", function () {
          load_example(2);
        }, "Exemple 2");
        ini_button("Example3", function () {
          load_example(3);
        }, "Exemple 3");
        ini_button("Example4", function () {
          load_example(4);
        }, "Exemple 4");
        ini_button("Example5", function () {
          load_example(5);
        }, "Exemple 5");
        var elem = null;
        elem = document.getElementById("selected_label");
        elem.onmouseover = function () {
          set_status("Affiche l'objet sélectionné (cliquer pour désélectionner)");
        };
        elem.onmouseout = function () {
          set_status("");
        };
        // Le logo ne renvoie plus vers la page d'accueil
        elem = document.getElementById("status_icon");
        elem.onmouseover = function () {
          /* statut vide */
        };
        elem.onmouseout = function () {
          /* statut vide */
        };
      }
      function ini_button(id, onclick, tooltip) {
        var btn = document.getElementById(id);
        btn.onclick = onclick;
        btn.onmouseover = function () {
          set_status(tooltip);
        };
        btn.onmouseout = function () {
          set_status("");
        };
      }
      function open_clicked() {
        if (IsRunning) {
          StopRun();
          set_default_icon();
          unlock_status();
          set_status("");
        }
        document.getElementById('fileinput').click();
      }
      function set_paper() {
        var center_row = document.getElementById("center_row");
        paper = new Raphael("center_row");
        PAPER_WIDTH = center_row.offsetWidth;
        PAPER_HEIGHT = center_row.offsetHeight;
        paper_initialize();
      }
      function clear_paper() {
        ResetPnet();
        paper.clear();
        paper_initialize();
      }
      function body_onresize() {
        if (paper != null) {
          var text = SerializePnet(Places, Trans, Arcs);
          localStorage.setItem("paper_temp", text);
          paper.remove();
          set_paper();
          var pn = JSON.parse(localStorage.getItem("paper_temp"));
          DeserializePnet(pn);
        }
      }
      function paper_initialize() {
        set_status("Prêt");
      }
      function run_clicked() {
        if (graph_loaded()) {
          set_run_icon();
          set_status("En cours...");
          lock_status();
          StartRun();
        } else {
          set_status("Aucun graphe valide chargé.");
        }
      }
      function set_run_icon() {
        document.getElementById("status_icon").className = "fa fa-cog fa-spin";
      }
      function set_default_icon() {
        document.getElementById("status_icon").className = "fa fa-caret-right";
      }
      function stop_clicked() {
        if (IsRunning) {
          set_default_icon();
          unlock_status();
          set_status("Arrêté.");
          StopRun();
        } else {
          set_status("Aucun réseau n'est en cours d'exécution.");
        }
      }
      function restore_local() {
        clear_paper();
        RestoreFromLocalStorage();
      }
      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
      function token_add() {
        if (Selected != null && Selected.node.key.substr(0, 1) == "P") {
          AddToken(Places[Selected.node.key]);
        } else {
          set_status("Aucune place sélectionnée.");
        }
      }
      function token_remove() {
        if (Selected != null && Selected.node.key.substr(0, 1) == "P") {
          RemoveToken(Places[Selected.node.key]);
        } else {
          set_status("Aucune place sélectionnée.");
        }
      }
    </script>
  </body>
</html>
